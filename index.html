<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillSwap</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome CDN for professional icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <header>
            <nav class="main-nav">
                <h1 id="logo">SkillSwap</h1>
                <div class="nav-controls">
                    <button id="theme-toggle" class="circular-btn" aria-label="Toggle theme">
                        <i id="theme-icon-light" class="fa-solid fa-sun"></i>
                        <i id="theme-icon-dark" class="fa-solid fa-moon hidden"></i>
                    </button>
                    <button id="search-icon" class="circular-btn" aria-label="Search"><i
                            class="fa-solid fa-magnifying-glass"></i></button>
                    <ul id="main-nav-list">
                        <div id="nav-pill"></div>
                        <li><a class="nav-link active" data-page="home-page"><i class="fa-solid fa-house"></i> Home</a></li>
                        <li><a class="nav-link" data-page="forum-page"><i class="fa-solid fa-users"></i> Forum</a></li>
                        <li><a class="nav-link" data-page="sessions-page"><i class="fa-solid fa-calendar-check"></i> My Sessions</a></li>
                        <li><a class="nav-link" data-page="profile-page"><i class="fa-solid fa-user-gear"></i> My Skills</a></li>
                        <li><a class="nav-link" data-page="subscription-page"><i class="fa-solid fa-star"></i> Subscription</a></li>
                    </ul>
                </div>
            </nav>
        </header>
        <main id="app-container"></main>
    </div>
    <div id="modals-container"></div>

    <!-- TEMPLATES -->
    <template id="home-page-template">
        <section class="page-section text-center">
            <div class="hero-card">
                <i class="hero-icon fa-solid fa-lightbulb"></i>
                <h2 class="hero-title">Teach what you know.</h2>
                <h3 class="hero-subtitle">Learn what you need.</h3>
                <div class="mt-6" style="display: flex; justify-content: center; gap: 1rem;">
                    <button class="btn" data-page="forum-page">Browse Skills</button>
                    <button id="home-start-session-btn" class="btn btn-primary">Start a Session <i class="fa-solid fa-plus"></i></button>
                </div>
            </div>
        </section>
    </template>

    <template id="forum-page-template">
        <section class="page-section">
            <div class="page-title-wrapper">
                <h2 class="page-title">Connect with Peers</h2>
            </div>
            <div id="user-list" class="grid-responsive"></div>
        </section>
    </template>

    <template id="sessions-page-template">
        <section class="page-section">
            <div class="page-title-wrapper">
                <h2 class="page-title">My Sessions</h2>
                <button id="add-session-btn" class="circular-btn" aria-label="Add Session"><i
                        class="fa-solid fa-plus"></i></button>
            </div>
            <div class="grid-2col">
                <div>
                    <h3 class="section-title">Upcoming</h3>
                    <div id="upcoming-sessions"></div>
                </div>
                <div>
                    <h3 class="section-title">Past Sessions</h3>
                    <div id="past-sessions"></div>
                </div>
            </div>
        </section>
    </template>

    <template id="profile-page-template">
        <section class="page-section">
            <div class="page-title-wrapper">
                <h2 class="page-title">My Skills Profile</h2>
            </div>
            <div id="profile-display" class="profile-card" style="max-width: 40rem; margin: 0 auto;"></div>
        </section>
    </template>

    <template id="video-call-page-template">
        <section class="page-section">
            <div class="video-grid">
                <div
                    style="aspect-ratio: 16/9; background: var(--fg); display: flex; align-items: center; justify-content: center; border-radius: 0.75rem;">
                    <p style="color: var(--bg); font-size: 1.25rem; font-weight: 600;">Me (You)</p>
                </div>
                <div
                    style="aspect-ratio: 16/9; background: var(--fg); display: flex; align-items: center; justify-content: center; border-radius: 0.75rem;">
                    <p id="other-user-name" style="color: var(--bg); font-size: 1.25rem; font-weight: 600;"></p>
                </div>
            </div>
            <div style="display: flex; justify-content: center; align-items: center; gap: 1.5rem; padding: 1rem 0;">
                <button id="mute-btn" class="icon-btn" aria-label="Mute"><i class="fa-solid fa-microphone"></i></button>
                <button id="end-call-btn" class="icon-btn icon-btn-end-call" aria-label="End Call"><i
                        class="fa-solid fa-phone-slash"></i></button>
                <button id="settings-btn" class="icon-btn" aria-label="Settings"><i
                        class="fa-solid fa-gear"></i></button>
            </div>
        </section>
    </template>

    <template id="subscription-page-template">
        <section class="page-section">
            <div class="page-title-wrapper">
                <h2 class="page-title">Subscription Plans</h2>
            </div>
            <div class="pricing-grid">
                <div class="pricing-card">
                    <div class="plan-icon"><i class="fa-solid fa-gem"></i></div>
                    <h3 class="plan-title">Entry</h3>
                    <p class="plan-desc">For those just getting started with peer-to-peer learning.</p>
                    <a href="#" class="btn plan-btn">Choose Plan</a>
                </div>
                <div class="pricing-card highlighted-card">
                    <div class="plan-icon"><i class="fa-solid fa-crown"></i></div>
                    <h3 class="plan-title">Gold</h3>
                    <p class="plan-desc">Unlock advanced features and priority support for all your needs.</p>
                    <a href="#" class="btn plan-btn btn-primary">Choose Plan</a>
                </div>
                <div class="pricing-card">
                    <div class="plan-icon"><i class="fa-solid fa-star"></i></div>
                    <h3 class="plan-title">Premium</h3>
                    <p class="plan-desc">Everything you need to succeed with full unlimited access.</p>
                    <a href="#" class="btn plan-btn">Choose Plan</a>
                </div>
            </div>
        </section>
    </template>

    <script>
        // DATA STORE
        let mySkills = { offering: 'Web Design Fundamentals', wanted: 'Advanced Python' };
        const dummyUsers = [{ id: 1, name: 'Alex C.', skillOffered: 'Python for Data Science', skillWanted: 'Graphic Design Basics' }, { id: 2, name: 'Maya R.', skillOffered: 'Advanced Javascript', skillWanted: 'Public Speaking' }, { id: 3, name: 'Jun H.', skillOffered: 'Mobile Photography', skillWanted: 'Beginner Spanish' }, { id: 4, name: 'Sara B.', skillOffered: 'Creative Writing', skillWanted: 'SEO Fundamentals' }, { id: 5, name: 'Leo P.', skillOffered: 'Financial Budgeting', skillWanted: 'Guitar Chords' }, { id: 6, name: 'Nina K.', skillOffered: 'UX/UI Prototyping', skillWanted: 'Baking Sourdough' },];
        let dummySessions = [{ id: 1, person: 'Maya R.', skill: 'Public Speaking', date: '2025-09-18T14:00', status: 'Upcoming' }, { id: 2, person: 'Jun H.', skill: 'Beginner Spanish', date: '2025-09-22T10:00', status: 'Upcoming' }, { id: 3, person: 'Leo P.', skill: 'Guitar Chords', date: '2025-09-05T11:00', status: 'Past' }, { id: 4, name: 'Sara B.', skill: 'SEO Fundamentals', date: '2025-08-28T16:00', status: 'Past' },];

        // CORE APP LOGIC
        document.addEventListener('DOMContentLoaded', () => {
            const app = {
                nodes: {
                    appContainer: document.getElementById('app-container'),
                    modalsContainer: document.getElementById('modals-container'),
                    navLinks: () => document.querySelectorAll('.nav-link'),
                    navList: document.getElementById('main-nav-list'),
                    navPill: document.getElementById('nav-pill'),
                    logo: document.getElementById('logo'),
                    searchIcon: document.getElementById('search-icon'),
                    themeToggle: document.getElementById('theme-toggle'),
                },
                init() { this.bindEvents(); this.showPage('home-page'); this.initTheme(); },
                bindEvents() {
                    this.nodes.logo.addEventListener('click', () => this.showPage('home-page'));
                    this.nodes.searchIcon.addEventListener('click', () => this.showSearchModal());
                    this.nodes.themeToggle.addEventListener('click', () => this.toggleTheme());
                    document.body.addEventListener('click', e => {
                        const navLink = e.target.closest('.nav-link'); if (navLink) { e.preventDefault(); this.showPage(navLink.dataset.page); return; }
                        const pageBtn = e.target.closest('button[data-page]'); if (pageBtn) { this.showPage(pageBtn.dataset.page); return; }
                        if (e.target.closest('#home-start-session-btn')) { this.showAddSessionModal(); }
                    });
                    window.addEventListener('resize', () => this.moveNavPill(document.querySelector('.nav-link.active')));
                },
                showPage(pageId) {
                    const { appContainer, navLinks, navPill } = this.nodes;
                    appContainer.innerHTML = '';
                    const template = document.getElementById(`${pageId}-template`);
                    if (template) {
                        appContainer.appendChild(template.content.cloneNode(true));
                        setTimeout(() => appContainer.querySelector('.page-section')?.classList.add('active'), 10);
                    }

                    let activeLink = null;
                    navLinks().forEach(link => {
                        const isActive = link.dataset.page === pageId;
                        link.classList.toggle('active', isActive);
                        if (isActive) activeLink = link;
                    });

                    if (activeLink) {
                        navPill.style.opacity = '1';
                        this.moveNavPill(activeLink);
                    } else {
                        navPill.style.opacity = '0';
                    }

                    if (pageId === 'forum-page') this.renderUsers(dummyUsers);
                    if (pageId === 'sessions-page') this.renderSessions();
                    if (pageId === 'profile-page') this.renderProfile();
                },
                moveNavPill(activeLink) {
                    if (!activeLink) return;
                    const { navList, navPill } = this.nodes;
                    const linkRect = activeLink.getBoundingClientRect();
                    const parentRect = navList.getBoundingClientRect();
                    navPill.style.width = `${linkRect.width}px`;
                    navPill.style.transform = `translateX(${linkRect.left - parentRect.left}px)`;
                },
                renderUsers(usersToRender) {
                    const container = document.getElementById('user-list'); if (!container) return;
                    container.innerHTML = usersToRender.map(user => `
                        <div class="user-card" data-user-name="${user.name}">
                            <h3 class="card-title">
                                <i class="fa-solid fa-user-circle"></i> ${user.name}
                            </h3>
                            <div class="mt-3">
                                <p class="label-text">Offering</p>
                                <p>${user.skillOffered}</p>
                            </div>
                            <div class="mt-3">
                                <p class="label-text">Wants</p>
                                <p>${user.skillWanted}</p>
                            </div>
                        </div>`).join('') || `<p class="muted-text" style="grid-column: 1 / -1; text-align: center;">No users found.</p>`;
                    container.querySelectorAll('.user-card').forEach(card => card.addEventListener('click', e => this.startVideoCall(e.currentTarget.dataset.userName)));
                },
                renderSessions() {
                    const upcomingContainer = document.getElementById('upcoming-sessions');
                    const pastContainer = document.getElementById('past-sessions');
                    if (!upcomingContainer || !pastContainer) return;
                    const formatDate = dateString => new Date(dateString).toLocaleString([], { month: 'short', day: 'numeric', year: 'numeric', hour: 'numeric', minute: '2-digit' });
                    const createSessionHTML = s => `
                        <div class="session-card mb-3">
                            <div class="flex-between-center">
                                <div>
                                    <p style="font-weight: 500;"><i class="fa-solid fa-calendar"></i> ${s.skill}</p>
                                    <p class="muted-text">with ${s.person}</p>
                                </div>
                                <p class="muted-text">${formatDate(s.date)}</p>
                            </div>
                        </div>`;
                    upcomingContainer.innerHTML = dummySessions.filter(s => s.status === 'Upcoming').map(createSessionHTML).join('') || `<p class="muted-text">No upcoming sessions.</p>`;
                    pastContainer.innerHTML = dummySessions.filter(s => s.status === 'Past').map(createSessionHTML).join('') || `<p class="muted-text">No past sessions.</p>`;
                    document.getElementById('add-session-btn')?.addEventListener('click', () => this.showAddSessionModal());
                },
                renderProfile() {
                    const displayDiv = document.getElementById('profile-display'); if (!displayDiv) return;
                    displayDiv.innerHTML = `
                        <div id="profile-view">
                            <div class="form-group">
                                <label class="label-text"><i class="fa-solid fa-chalkboard-user"></i> I can teach:</label>
                                <p class="display-text">${mySkills.offering}</p>
                            </div>
                            <div class="form-group">
                                <label class="label-text"><i class="fa-solid fa-book-open-reader"></i> I want to learn:</label>
                                <p class="display-text">${mySkills.wanted}</p>
                            </div>
                            <button id="edit-profile-btn" class="btn mt-4">Edit Profile <i class="fa-solid fa-pen"></i></button>
                        </div>
                        <div id="profile-form" class="hidden">
                            <div class="form-group">
                                <label class="label-text" for="offering-input"><i class="fa-solid fa-chalkboard-user"></i> I can teach:</label>
                                <input id="offering-input" type="text" value="${mySkills.offering}">
                            </div>
                            <div class="form-group">
                                <label class="label-text" for="wanted-input"><i class="fa-solid fa-book-open-reader"></i> I want to learn:</label>
                                <input id="wanted-input" type="text" value="${mySkills.wanted}">
                            </div>
                            <div style="display: flex; gap: 1rem;" class="mt-6">
                                <button id="save-profile-btn" class="btn btn-primary">Save Changes <i class="fa-solid fa-check"></i></button>
                                <button id="cancel-edit-btn" class="btn">Cancel <i class="fa-solid fa-xmark"></i></button>
                            </div>
                        </div>`;
                    const view = displayDiv.querySelector('#profile-view'), form = displayDiv.querySelector('#profile-form');
                    displayDiv.querySelector('#edit-profile-btn').addEventListener('click', () => { view.classList.add('hidden'); form.classList.remove('hidden'); });
                    displayDiv.querySelector('#cancel-edit-btn').addEventListener('click', () => { form.classList.add('hidden'); view.classList.remove('hidden'); });
                    displayDiv.querySelector('#save-profile-btn').addEventListener('click', () => { mySkills.offering = displayDiv.querySelector('#offering-input').value; mySkills.wanted = displayDiv.querySelector('#wanted-input').value; this.renderProfile(); });
                },
                startVideoCall(userName) {
                    this.showPage('video-call-page');
                    setTimeout(() => {
                        const nameEl = document.getElementById('other-user-name');
                        if (nameEl) nameEl.textContent = userName;
                        this.bindVideoControlEvents();
                    }, 50);
                },
                bindVideoControlEvents() {
                    const muteBtn = document.getElementById('mute-btn');
                    document.getElementById('end-call-btn')?.addEventListener('click', () => this.showPage('forum-page'));
                    muteBtn?.addEventListener('click', () => {
                        muteBtn.classList.toggle('muted');
                        muteBtn.innerHTML = muteBtn.classList.contains('muted')
                            ? `<i class="fa-solid fa-microphone-slash"></i>`
                            : `<i class="fa-solid fa-microphone"></i>`;
                    });
                    document.getElementById('settings-btn')?.addEventListener('click', () => this.showCallSettingsModal());
                },
                showModal(content) {
                    this.nodes.modalsContainer.innerHTML = ''; // Clear previous modals
                    const modalOverlay = document.createElement('div');
                    modalOverlay.className = 'modal-overlay active';
                    modalOverlay.innerHTML = `<div class="dialog">${content}</div>`;
                    this.nodes.modalsContainer.appendChild(modalOverlay);
                    const closeModal = () => modalOverlay.remove();
                    modalOverlay.querySelector('.close-modal-btn')?.addEventListener('click', closeModal);
                    modalOverlay.addEventListener('click', e => { if (e.target === modalOverlay) closeModal(); });
                    return modalOverlay;
                },
                showSearchModal() {
                    const modal = this.showModal(`
                        <h3 class="dialog-title"><i class="fa-solid fa-magnifying-glass"></i> Search Skills</h3>
                        <div class="form-group">
                            <input id="search-input" type="text" placeholder="e.g., Python, Guitar...">
                        </div>
                        <div id="search-results" style="max-height: 300px; overflow-y: auto;"></div>
                        <button class="close-modal-btn hidden"></button>`);
                    modal.querySelector('#search-input').addEventListener('keyup', e => {
                        const term = e.target.value.toLowerCase();
                        const results = dummyUsers.filter(u => u.skillOffered.toLowerCase().includes(term));
                        modal.querySelector('#search-results').innerHTML = results.map(u => `<div class="user-card mb-2" data-user-name="${u.name}"><i class="fa-solid fa-circle-user"></i> ${u.skillOffered} by <strong>${u.name}</strong></div>`).join('');
                        modal.querySelectorAll('.user-card').forEach(card => card.addEventListener('click', e => { this.startVideoCall(e.currentTarget.dataset.userName); modal.remove(); }));
                    });
                },
                showAddSessionModal() {
                    const modal = this.showModal(`
                        <h3 class="dialog-title"><i class="fa-solid fa-calendar-plus"></i> Schedule a Session</h3>
                        <div class="form-group"><label for="session-skill-input" class="label-text">Skill</label><input type="text" id="session-skill-input"></div>
                        <div class="form-group"><label for="session-person-input" class="label-text">With</label><input type="text" id="session-person-input"></div>
                        <div class="form-group"><label for="session-date-input" class="label-text">Date & Time</label><input id="session-date-input" type="datetime-local"></div>
                        <button id="save-session-btn" class="btn btn-primary mt-4">Schedule <i class="fa-solid fa-check"></i></button>
                        <button class="close-modal-btn hidden"></button>`);
                    modal.querySelector('#save-session-btn').addEventListener('click', () => {
                        const newSession = { id: dummySessions.length + 1, person: modal.querySelector('#session-person-input').value, skill: modal.querySelector('#session-skill-input').value, date: modal.querySelector('#session-date-input').value, status: 'Upcoming' };
                        if (newSession.person && newSession.skill && newSession.date) { dummySessions.unshift(newSession); this.renderSessions(); modal.remove(); }
                    });
                },
                showCallSettingsModal() {
                    this.showModal(`
                        <h3 class="dialog-title"><i class="fa-solid fa-gear"></i> Call Settings</h3>
                        <div class="form-group">
                            <label for="camera-select" class="label-text">Camera</label>
                            <select id="camera-select" class="form-select">
                                <option>Integrated Webcam (HD)</option>
                                <option>External Cam Pro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="mic-select" class="label-text">Microphone</label>
                            <select id="mic-select" class="form-select">
                                <option>Default - Internal Mic</option>
                                <option>USB Audio Device</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="volume-slider" class="label-text">Output Volume</label>
                            <input id="volume-slider" type="range" class="form-slider">
                        </div>
                        <div class="form-group flex-between-center">
                            <label for="noise-cancel-toggle" class="label-text" style="margin-bottom: 0;">Noise Cancellation</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="noise-cancel-toggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <button class="close-modal-btn btn mt-6">Done <i class="fa-solid fa-check"></i></button>`);
                },
                initTheme() {
                    const savedTheme = localStorage.getItem('theme') || 'dark';
                    document.documentElement.classList.toggle('light-theme', savedTheme === 'light');
                    this.updateThemeIcons(savedTheme);
                },
                toggleTheme() {
                    const isLight = document.documentElement.classList.toggle('light-theme');
                    const newTheme = isLight ? 'light' : 'dark';
                    localStorage.setItem('theme', newTheme);
                    this.updateThemeIcons(newTheme);
                },
                updateThemeIcons(theme) {
                    document.getElementById('theme-icon-light').classList.toggle('hidden', theme === 'dark');
                    document.getElementById('theme-icon-dark').classList.toggle('hidden', theme === 'light');
                }
            };
            app.init();
        });
    </script>
</body>

</html>
